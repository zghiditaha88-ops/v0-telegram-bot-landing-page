# Quick Setup Guide for Vercel + Supabase

## Immediate Steps

### 1. Add Required Environment Variable in Vercel

Go to your Vercel project → **Settings** → **Environment Variables** and add:

#### `REDIRECT_SECRET` ⚠️ **REQUIRED**
This is used by `/api/r` endpoint for secure redirect token verification.

Generate a secure random string:
```bash
openssl rand -hex 32
```
Copy the output and paste it as the value for `REDIRECT_SECRET` in Vercel.

**Note:** Without this, the redirect API endpoint (`/api/r`) will return a 500 error.

---

### Optional Variables (Not Required Right Now)

#### `NEXT_PUBLIC_SITE_URL`
- Not currently used in the codebase
- Optional for future features (e.g., generating redirect URLs)
- Can add later if needed: `https://your-project.vercel.app`

#### `DATABASE_URL`
- **Not needed!** Prisma automatically uses `SUPABASE_POSTGRES_PRISMA_URL` which you already have
- `lib/prisma.ts` checks for `SUPABASE_POSTGRES_PRISMA_URL` first, then falls back to `DATABASE_URL`
- Since you have Supabase, this is already handled ✅

### 2. Deploy to Vercel

Once you've added the environment variables:
1. Push your changes to GitHub
2. Vercel will automatically deploy
3. The build will run `prisma generate` automatically (included in build script)

### 3. Run Database Migration

**Option A: Via Vercel CLI** (Recommended)
```bash
vercel env pull .env.local  # Pull env vars locally
npm run db:migrate          # Run migration
```

**Option B: Via Supabase Dashboard**
1. Go to Supabase Dashboard → SQL Editor
2. Run the migration SQL manually (generated by Prisma)

### 4. Verify

1. Visit `https://your-project.vercel.app/api/health`
   - Should return: `{"ok":true,"time":"..."}`

2. Visit `https://your-project.vercel.app/dashboard`
   - Should show the dashboard (empty watches/drops initially)

## Current Status

✅ **Already configured:**
- Supabase PostgreSQL connection (`SUPABASE_POSTGRES_PRISMA_URL`) - Prisma uses this automatically
- All Supabase variables (auto-synced from v0)
- Prisma schema with all models
- API routes created
- Dashboard UI created
- Build script includes `prisma generate`

⏳ **Need to add (only 1 required):**
- `REDIRECT_SECRET` - Required for `/api/r` redirect endpoint to work

## What Happens Next

1. Prisma will generate types on build (already in build script)
2. You'll need to run migrations once to create tables
3. After that, everything should work!

## Troubleshooting

**`/api/r` endpoint returns 500 "Server configuration error":**
- Missing `REDIRECT_SECRET` - Add it to Vercel environment variables

**Prisma can't connect:**
- Verify `SUPABASE_POSTGRES_PRISMA_URL` exists in Vercel (should auto-sync from v0)
- Check Supabase project is not paused
- Ensure database is accessible from Vercel

**Build fails:**
- Make sure `SUPABASE_POSTGRES_PRISMA_URL` is available (auto-synced from v0)
- Check Vercel build logs for specific errors
- Verify Prisma generates successfully (happens automatically in build script)

**API returns 500 errors:**
- Check Vercel function logs
- Verify database migrations have been run (one-time setup)
- Ensure `REDIRECT_SECRET` is set if using `/api/r` endpoint

